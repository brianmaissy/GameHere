<html>
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
        <link rel="stylesheet" type="text/css" href="multipong.css" />
        <script src="jquery-1.7.1.min.js"></script>
        <script src="/socket.io/socket.io.js"></script>
        <script type="text/javascript">            
            var socket = io.connect('http://' + window.location.host);
            var h = 0;
            var w = 0;
            $(document).ready(function(){
                w = $("#game").width();
                h = $("#game").height();
                $("#ball").css('width', h * <%= game.ballRadius %>*2);
                $("#ball").css('height', h * <%= game.ballRadius %>*2);
                $("#ball").css('-moz-border-radius', h * <%= game.ballRadius %>)
                $("#ball").css('border-radius', h * <%= game.ballRadius %>)
            });
            socket.on('connect', function(){
                $('#message').html('<%= game.title %> display connected');
                socket.emit('newDisplay');
            });
            socket.on('update', function(data){
                $('.player').hide();
                $('#ball').hide();
                for(var i=0; i<data.state.players.left.length; i++){
                    drawPlayer(data.state.players.left[i], "left", i);
                }
                for(var i=0; i<data.state.players.right.length; i++){
                    drawPlayer(data.state.players.right[i], "right", i);
                }
                $("#ball").css('top', h * (data.state.ball.y - <%= game.ballRadius %>));
                $("#ball").css('left', w * data.state.ball.x - h * <%= game.ballRadius %>);
                $('#ball').show();
                $('#leftscore').html(data.state.score.left);
                $('#rightscore').html(data.state.score.right);
            });
            function drawPlayer(player, side, number){
                var div = $('.player#' + side + number);
                if(div.length == 0){
                    var container = $('#leftfield');
                    if(side == "right"){
                        container = $('#rightfield');
                    }
                    container.append('<div class="player" id="' + side + number + '" style="height:' + h * <%= game.paddleWidth %> + 'px; width: ' + w * <%= game.paddleThickness %> + 'px;"></div>');
                    div = $('.player#' + side + number);
                }
                if(side == "right"){
                    div.css('left', w * player.x - $("#leftfield").width() - w * <%= game.paddleThickness/2 %>);
                }else{
                    div.css('left', w * player.x - w * <%= game.paddleThickness/2 %>);
                }
                div.css('top', h * player.y);
                div.show();
            }
        </script>
    </head>
    <body>
        <div id="message">Not Connected</div>
        <div id="game">
            <div id="leftfield"></div>
                <div class="score" id="leftscore"></div>
            <div id="rightfield"></div>
                <div class="score" id="rightscore"></div>
            <div id="ball"></div>
        </div>
    </body>
</html>
